<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
    <title id="title">M510 Tennis</title>
    <script type="module">
		// 	import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
		// 	import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

		// 	// Firebase 設定（自分のプロジェクトの情報を入力）
		// 	const firebaseConfig = {
		// 			apiKey: "AIzaSyDOFYIn_PQSDHRgdjaSIk3uSK50UeYFyIk",
		// 			authDomain: "my-web-game-f7504.firebaseapp.com",
		// 			databaseURL: "https://my-web-game-f7504-default-rtdb.asia-southeast1.firebasedatabase.app/",
		// 			projectId: "my-web-game-f7504",
		// 			storageBucket: "my-web-game-f7504.firebasestorage.app",
		// 			messagingSenderId: "855871162021",
		// 			appId: "1:855871162021:web:29fadb3c0d20ca4f7a2f4c",
		// 	};

		// 	// Firebase 初期化
		// 	const firebase = initializeApp(firebaseConfig);
		// 	const db = getDatabase(firebase);

		// 	function saveHighScore(score) {
		// 		set(ref(db, 'ball'), {
		// 			highScore: score
		// 		});
		// 	}
		// 	window.saveHighScore = saveHighScore;

		// 	// ハイスコアを取得
		// 	async function getHighScore() {
		// 		console.log("getHighScore");
		// 		const highScoreRef = ref(db, "ball/highScore");
		// 		const snapshot = await get(highScoreRef);
		// 		if (snapshot.exists()) {
		// 			return snapshot.val();
		// 		} else {
		// 			return 0;
		// 		}
		// 	}
		// 	window.getHighScore = getHighScore;
    </script>
		<script>
			let score = 0;	// スコア
			let x = 150;	// 初期位置のx座標
			let y = 150;	// 初期位置のy座標
			let dx = 2;		// y座標の変化量
			let dy = 2;		// y座標の変化量
			let r = 10;		// ボールの半径
			let wallWidth = 10; // 壁の幅

			let canvas;
			let ctx;

			// キャンバスをクリア
			function clearCanvas(ctx, canvas) {
				ctx.clearRect(0, 0, canvas.width, canvas.height); // 画面をクリア
			}
			// 壁を描画する
			function drawWalls(ctx, canvas) {
				ctx.fillStyle = "gray"; // 壁の色
				// 上の壁
				ctx.fillRect(0, 0, canvas.width, wallWidth);
				// 下の壁
				ctx.fillRect(0, canvas.height - wallWidth, canvas.width, wallWidth);
				// 左の壁
				ctx.fillRect(0, 0, wallWidth, canvas.height);
				// 右の壁
				ctx.fillRect(canvas.width - wallWidth, 0, wallWidth, canvas.height);
			}
			// ボールを描く
			function drawBall(ctx, x, y) {
				ctx.beginPath();
				ctx.arc(x, y, r, 0, Math.PI * 2); // 中心(x,y)、半径r、0度から360度まで
				ctx.fillStyle = "orange"; // 塗りつぶしの色
				ctx.fill(); // 円を塗りつぶす
				ctx.stroke(); // 円の輪郭を描く
			}

			// ゲームのメインループ
			function gameMain() {
				// if (gameOver) return;	// ゲームオーバーの場合は描画しない

				clearCanvas(ctx, canvas); // 画面をクリア
				drawWalls(ctx, canvas); // 壁を描画
				drawBall(ctx, x, y);	// ボールを描く

				x += dx; // x座標をdx分だけ移動
				y += dy; // y座標をdy分だけ移動

				// 壁との衝突判定
				if (x - wallWidth - r <= 0 || x + wallWidth + r >= canvas.width) { // 左右の壁
						dx = -dx; // x方向の移動を反転
				}
				if (y - wallWidth - r <= 0 || y + wallWidth + r >= canvas.height) { // 上下の壁
						dy = -dy; // y方向の移動を反転
				}
				requestAnimationFrame(gameMain); // 次のフレームを描画
			}

			async function init() {
				// コンテキストの取得
				canvas = document.getElementById("canvas");
				ctx = canvas.getContext("2d");
				gameMain()	// 描画を開始
			}

		</script>
		<style>
			#title-screen {
				position: absolute;
				top: 0;
				left: 0;
				width: 700px;
				height: 400px;
				background-color: rgba(255, 255, 255, 0.7);
				color: red;
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				font-size: 24px;
				z-index: 10;
			}
		</style>
	</head>
	<body onload="init()">
		<canvas id="canvas" width="700" height="400"></canvas>
		<!-- <div id="score">Score: 0</div> スコア表示用の要素 -->
		<!-- <div">Hi Score: <span id="hi-score">0</span></div> スコア表示用の要素 -->
		<!-- <div id="game-over"></div> ゲームオーバー表示用の要素 -->
		<!-- <div id="title-screen">
			<div>M510 Ball</div>
			<div>PUSH SPACE KEY TO START</div>
		</div> タイトル画面用の要素 -->
	</body>
</html>